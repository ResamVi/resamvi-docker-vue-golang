version: "3"  

services:  
  mongodb-seed:
    image: bwnyasse/docker-mongodb-worker
    environment:
      - MONGO_HOST=mongodb
      - MONGO_PORT=27017
      - MONGO_DB_NAME=resamvi
      - MONGO_COLLECTION_NAME=entries
    depends_on:
      - mongodb
    command: "/start.sh -i"
  
  mongodb:
    image: mongo:3.4-jessie
    volumes:
      - ./srv/mongodb.conf:/etc/mongodb.conf
      - ./srv/data:/data/db
    ports:
      - "27017:27017"

  nginx:
    image: nginx
    volumes:
      - ./srv/nginx.conf:/etc/nginx/nginx.conf
      - ./build/:/usr/share/nginx/website
    ports:
      - "9001:9001"
  
  go:
    image: golang
    volumes:
      - ../go/:/go/
      - ./srv/server.go:/srv/server.go
    command: go run /srv/server.go
    ports:
      - "8080:8080"

    